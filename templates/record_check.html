{% extends "base.html" %}
{% load static %}
{% block content %}
  <table class="record-check-table">
    <thead>
      <tr>
        <th>ID</th>
        <th>User</th>
        <th>Title</th>
        <th>Date</th>
        <th>image</th>
        <th>Distance</th>
        <th>Pace</th>
        <th>Time</th>
        <th>Memo</th>
        <th>Confirmed</th>
        <th>OK!!</th>
        <th>Delete</th>
      </tr>
    </thead>

    {% for data in record %}
      <tbody>
        <tr>
          <td>{{ data.record_id }}</td>
          <td>{{ data.user }}</td>
          <td>{{ data.title }}</td>
          <td>{{ data.record_date }}</td>
          <td>
            <a href="{{ data.image.url }}" target="_blank">
              <img src="/media/{{ data.image }}" alt="logo-top" height="100px" width="100px">
            </a>
          </td>
          <td>{{ data.distance }}</td>
          <td>{{ data.pace_m }}분
            {{ data.pace_s }}초</td>
          <td>{{ data.time_m }}분
            {{ data.time_s }}초</td>
          <td>{{ data.desc }}</td>
          <td>{{ data.confirmed }}</td>
          <td>
            {% if data.confirmed == False %}
              <form action="{% url 'runres:recordConfirm' data.record_id %}" method="post">
                {% csrf_token %}
                <button type="submit" class="yes-btn">OK</button>
              </form>
            {% else %}
              <form action="{% url 'runres:recordReject' data.record_id %}" method="post">
                {% csrf_token %}
                <button type="submit" class="no-btn">NO</button>
              </form>
            {% endif %}
          </td>
          <td>
            <!--form action="{% url 'runres:recordDelete' data.record_id %}" method="post"> {% csrf_token %} <button type="submit" class="yes-btn">Delete</button> </form-->
            <button onclick="openDeleteModal('{{ data.record_id }}')" class="btn-delete">
              삭제
            </button>
          </td>
        </tr>
      </tbody>

    {% endfor %}
  </table>
  <!-- 모달 오버레이 -->
  <div id="deleteModal" class="modal-overlay">
    <div class="modal-box">
      <h3>삭제 확인</h3>
      <p>정말 삭제하시겠습니까?</p>

      <div class="modal-buttons">
        <button type="button" onclick="closeDeleteModal()">취소</button>

        <!-- 실제 삭제 form (동적으로 action 변경됨) -->
        <form id="deleteForm" method="post">
          {% csrf_token %}
          <button type="submit">삭제</button>
        </form>
      </div>
    </div>
  </div>
  <script>
    function openDeleteModal(pk) {
      const modal = document.getElementById("deleteModal");
      const form = document.getElementById("deleteForm");

      // Django URL 패턴에 맞게 action 설정
      form.action = `/runres/recordDelete/${pk}`;

      modal
        .classList
        .add("active");
    }

    function closeDeleteModal() {
      document
        .getElementById("deleteModal")
        .classList
        .remove("active");
    }

    // 오버레이 클릭시 닫기 (선택)
    document
      .getElementById("deleteModal")
      .addEventListener("click", function (e) {
        if (e.target === this) 
          closeDeleteModal();
        }
      );
  </script>
{% endblock content %}
