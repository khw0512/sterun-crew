{% extends "base.html" %}
{% load static %}
{% block content %}
  <div class="space-h30"></div>
  <table class="record-check-table">
    <thead>
      <tr>
        <th>마라톤명</th>
        <th>러너</th>
        <th>날짜</th>
        <th>거리</th>
        <th>기록</th>
        <th>이미지</th>
        <th>생성일</th>
        <th>설명</th>
        <th>상태</th>
        <th>상태 변경</th>
        <th>삭제</th>
      </tr>
    </thead>

    {% for data in record %}
      <tbody>
        <tr>
          <td>{{ data.event_name }}</td>
          <td>{{ data.runner }}</td>
          <td>{{ data.date }}</td>
          <td>{{ data.get_category_display }}</td>
          <td>{{ data.record }}</td>
          <td>
            <a href="{{ data.evidence_url.url }}" target="_blank">
              <img src="/media/{{ data.evidence_url }}" alt="logo-top" height="100px" width="100px">
            </a>
          </td>
          <td>{{ data.created_at }}</td>
          <td>{{ data.desc }}</td>
          <td>{{ data.get_status_display }}</td>
          <td>
            {% if data.status == 'pending' %}
              <div class="flex-row-center">
                <form action="{% url 'runres:pbConfirm' data.id %}" method="post">
                  {% csrf_token %}
                  <button type="submit" class="yes-btn">승인</button>
                </form>
                <form action="{% url 'runres:pbReject' data.id %}" method="post">
                  {% csrf_token %}
                  <button type="submit" class="no-btn">거절</button>
                </form>
              </div>
            {% elif data.status == 'verified' %}
              <form action="{% url 'runres:pbReject' data.id %}" method="post">
                {% csrf_token %}
                <div class="flex-row-center">
                  <button type="submit" class="no-btn">거절</button>
                </div>
              </form>
            {% else %}
              <form action="{% url 'runres:pbConfirm' data.id %}" method="post">
                {% csrf_token %}
                <div class="flex-row-center">
                  <button type="submit" class="yes-btn">승인</button>
                </div>
              </form>
            {% endif %}
          </td>
          <td>
            <button onclick="openDeleteModal('{{ data.id }}')" class="btn-delete">
              삭제
            </button>
          </td>
        </tr>
      </tbody>

    {% endfor %}
  </table>
  <!-- 모달 오버레이 -->
  <div id="deleteModal" class="modal-overlay">
    <div class="modal-box">
      <h3>삭제 확인</h3>
      <p>정말 삭제하시겠습니까?</p>

      <div class="modal-buttons">
        <button type="button" onclick="closeDeleteModal()">취소</button>

        <!-- 실제 삭제 form (동적으로 action 변경됨) -->
        <form id="deleteForm" method="post">
          {% csrf_token %}
          <button type="submit">삭제</button>
        </form>
      </div>
    </div>
  </div>
  <script>
    function openDeleteModal(pk) {
      const modal = document.getElementById("deleteModal");
      const form = document.getElementById("deleteForm");

      // Django URL 패턴에 맞게 action 설정
      form.action = `/runres/pbDelete/${pk}`;

      modal
        .classList
        .add("active");
    }

    function closeDeleteModal() {
      document
        .getElementById("deleteModal")
        .classList
        .remove("active");
    }

    // 오버레이 클릭시 닫기 (선택)
    document
      .getElementById("deleteModal")
      .addEventListener("click", function (e) {
        if (e.target === this) 
          closeDeleteModal();
        }
      );
  </script>
{% endblock content %}
